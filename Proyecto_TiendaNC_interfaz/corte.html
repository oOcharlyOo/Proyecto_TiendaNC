<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sistema de Punto de Venta - CORTE DE CAJA</title>
    <link rel="stylesheet" href="resources/style/output.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.2/dist/chart.umd.min.js"></script>
</head>
<body class="main-page-body">
    
    <!-- BARRA SUPERIOR DE NAVEGACIÓN -->
    <div id="navbar-placeholder"></div>

    <div class="main-container" style="height: max-content;">
        <div class="items-center justify-center w-full panel-transparent rounded-lg shadow-2xl p-4 sm:p-6 md:p-8 space-y-4 sm:space-y-6 md:space-y-8 z-50">
            <header class="border-b pb-4">
                <h1 class="text-2xl sm:text-3xl font-bold text-gray-800">Corte de Caja</h1>
                <p class="text-sm sm:text-base text-gray-600 mt-1">Genera y visualiza el reporte de tu corte de caja o consulta reportes de días anteriores.</p>
            </header>

            <div class="flex flex-col sm:flex-row space-y-4 sm:space-y-0 sm:space-x-4 mb-4 sm:mb-8 justify-center">
                <button id="generateCorteBtn" class="btn-primary text-white font-semibold py-2 px-6 sm:py-3 sm:px-8 rounded-lg transition duration-150 shadow-md text-base sm:text-lg">
                    Generar Corte de Caja
                </button>
                <button id="generateDailyReportBtn" class="btn-primary text-white font-semibold py-2 px-6 sm:py-3 sm:px-8 rounded-lg transition duration-150 shadow-md text-base sm:text-lg hidden">
                    Generar Reporte por Día
                </button>
                <button id="generateMonthlyReportBtn" class="btn-primary text-white font-semibold py-2 px-6 sm:py-3 sm:px-8 rounded-lg transition duration-150 shadow-md text-base sm:text-lg">
                    Generar Reporte Mensual
                </button>
            </div>

            <section id="corteReporte" class="hidden">
                <h2 id="reportTitle" class="text-lg sm:text-xl font-semibold text-gray-700 mb-3 sm:mb-4">Reporte del Corte</h2>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4 sm:gap-6">
                    <div class="summary-card income-card">
                        <p class="summary-title text-xs sm:text-sm whitespace-normal break-words">Fecha del Reporte</p>
                        <p id="reporteFechaCorte" class="summary-value text-xl sm:text-2xl text-gray-800 whitespace-normal break-words"></p>
                    </div>
                    <div class="summary-card income-card">
                        <p class="summary-title text-xs sm:text-sm whitespace-normal break-words">Cajero</p>
                        <p id="reporteCajero" class="summary-value text-xl sm:text-2xl text-gray-800 whitespace-normal break-words"></p>
                    </div>
                </div>

                <div class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-4 gap-4 sm:gap-6 mt-4 sm:mt-6">
                    <div class="summary-card">
                        <p class="summary-title text-xs sm:text-sm text-income-color whitespace-normal break-words">Monto Inicial</p>
                        <p id="reporteMontoInicial" class="summary-value text-xl sm:text-2xl income-value whitespace-normal break-words"></p>
                    </div>
                    <!-- New card for Ventas en Efectivo -->
                    <div class="summary-card">
                        <p class="summary-title text-xs sm:text-sm text-income-color whitespace-normal break-words">Ventas en Efectivo</p>
                        <p id="reporteVentasEfectivo" class="summary-value text-xl sm:text-2xl income-value whitespace-normal break-words"></p>
                    </div>
                    <!-- Ventas por Transferencia (formerly Otros Ingresos) -->
                    <div class="summary-card">
                        <p class="summary-title text-xs sm:text-sm text-profit-color whitespace-normal break-words">Ventas por Transferencia</p>
                        <p id="reporteOtrosIngresos" class="summary-value text-xl sm:text-2xl income-value whitespace-normal break-words"></p>
                    </div>
                    <!-- Tickets del Día -->
                    <div class="summary-card">
                        <p class="summary-title text-xs sm:text-sm text-cash-flow-color whitespace-normal break-words">Tickets del Día</p>
                        <p id="reporteTotalTicketsDia" class="summary-value text-xl sm:text-2xl whitespace-normal break-words">0</p>
                    </div>
                    <!-- Total Ventas (SPANS 2 COLUMNS) -->
                    <div class="summary-card md:col-span-2">
                        <p class="summary-title text-xs sm:text-sm text-income-color whitespace-normal break-words">Total Ventas</p>
                        <p id="reporteTotalVentas" class="summary-value text-xl sm:text-2xl income-value whitespace-normal break-words"></p>
                    </div>
                    <!-- Otros Ingresos (Entradas Manuales) -->
                    <div class="summary-card">
                        <p class="summary-title text-xs sm:text-sm text-[#af7810] whitespace-normal break-words">Otras Entradas</p>
                        <p id="reporteOtrasEntradas" class="summary-value text-xl sm:text-2xl income-value whitespace-normal break-words">$0.00</p>
                    </div>
                    <!-- Total Egresos -->
                    <div class="summary-card">
                        <p class="summary-title text-xs sm:text-sm text-danger whitespace-normal break-words">Total Egresos</p>
                        <p id="reporteTotalEgresos" class="summary-value text-xl sm:text-2xl expense-value whitespace-normal break-words"></p>
                    </div>
                    <!-- Ganancia Total -->
                    <div class="summary-card profit-card">
                        <p class="summary-title text-xs sm:text-sm text-profit-color whitespace-normal break-words">Ganancia Total</p>
                        <p id="reporteGananciaTotal" class="summary-value text-xl sm:text-2xl profit-value whitespace-normal break-words"></p>
                        <p class="text-xs text-gray-500 mt-1">Beneficio total del corte</p>
                    </div>
                </div>

                <div class="summary-card cash-flow-card mt-4 sm:mt-6">
                    <p class="summary-title text-sm sm:text-base text-profit-color whitespace-normal break-words">SALDO FINAL CALCULADO</p>
                    <p id="reporteSaldoFinalCalculado" class="summary-value text-3xl sm:text-4xl cash-flow-value whitespace-normal break-words"></p>
                </div>
                
                <!-- GRÁFICA PIE CHART AGREGADA AQUÍ -->
                <div class="mt-6 sm:mt-8">
                    <h3 id="chartTitle" class="text-lg sm:text-xl font-semibold text-gray-700 mb-3 sm:mb-4 border-t pt-3 sm:pt-4">Composición del Flujo de Efectivo Bruto (Entradas)</h3>
                    <div class="panel-transparent p-4 sm:p-6 rounded-xl shadow-lg flex justify-center items-center min-h-0">
                        <canvas id="cashFlowChart"></canvas>
                    </div>
                </div>
                <!-- FIN GRÁFICA -->
                
                <div class="flex justify-center pt-6 sm:pt-8">
                    <button id="cerrarTurnoBtn" class="btn-primary text-white font-semibold py-2 px-8 sm:py-3 sm:px-12 rounded-lg transition duration-150 shadow-xl text-base sm:text-lg">
                        Cerrar Turno
                    </button>
                </div>
            </section>
        </div>
    </div>

    <!-- Modal para seleccionar fecha de reporte diario -->
    <div id="dailyReportModal" class="fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full z-50" hidden>
        <div class="relative top-20 mx-auto p-5 border w-11/12 max-w-sm shadow-lg rounded-md bg-white">
            <div class="mt-3 text-center">
                <h3 class="text-lg leading-6 font-medium text-gray-900">Generar Reporte por Día</h3>
                <div class="mt-4 px-7 py-3">
                    <label for="reportDate" class="block text-sm font-medium text-gray-700 text-left">Selecciona una fecha:</label>
                    <input type="date" id="reportDate" name="reportDate" class="mt-1 block w-full px-3 py-2 bg-white border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-primary focus:border-primary sm:text-sm">
                </div>
                <div class="items-center px-4 py-3 space-x-4">
                    <button id="generateReportFromModalBtn" class="px-4 py-2 btn-primary text-white text-base font-medium rounded-md shadow-sm hover:bg-primary-dark focus:outline-none focus:ring-2 focus:ring-primary">
                        Generar Reporte
                    </button>
                    <button id="cancelModalBtn" class="px-4 py-2 btn-secondary text-white text-base font-medium rounded-md shadow-sm hover:bg-secondary-dark focus:outline-none focus:ring-2 focus:ring-secondary">
                        Cancelar
                    </button>
                </div>
            </div>
        </div>
    </div>

<!-- Modal para reporte mensual (Nuevo Diseño) -->
<div id="monthlyReportModal" class="fixed inset-0 bg-slate-900/50 backdrop-blur-sm z-50 hidden flex items-center justify-center" hidden>
    <div class="relative w-full max-w-md md:max-w-4xl bg-slate-100 rounded-lg shadow-2xl flex flex-col max-h-[90vh] overflow-y-auto">
        <!-- Header -->
        <div class="p-4 border-b border-slate-200 flex items-center justify-between">
            <div>
                <h3 class="text-lg font-bold text-slate-800">Reporte Mensual de Ventas</h3>
                <p class="text-sm text-slate-500">Analiza el rendimiento de tus ventas mes a mes.</p>
            </div>
            <button id="cancelMonthlyModalBtn" class="p-2 rounded-full hover:bg-slate-200">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-slate-600" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" /></svg>
            </button>
        </div>

        <!-- Body -->
        <div class="flex-grow p-4 grid grid-cols-12 gap-6">
            <!-- Left Panel (Controls & Stats) -->
            <div class="col-span-12 lg:col-span-4 bg-white rounded-lg p-4 space-y-6">
                <!-- Month Selector -->
                <div>
                    <label for="reportMonth" class="block text-sm font-semibold text-slate-700 mb-1">Seleccionar Mes:</label>
                    <input type="month" id="reportMonth" name="reportMonth" class="w-full text-sm p-2 border border-slate-300 rounded-md focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500">
                    <button id="modalGenerateMonthlyReportBtn" class="w-full mt-3 btn-primary text-white font-bold text-sm py-2 px-4 rounded-md transition-all flex items-center justify-center">
                        Generar Reporte
                    </button>
                </div>

                <!-- Stats -->
                <div class="space-y-4">
                    <h4 class="text-sm font-bold text-slate-500 uppercase tracking-wider">Estadísticas del Mes</h4>
                    <!-- Ventas Totales -->
                    <div class="flex items-center justify-between">
                        <div class="flex items-center space-x-2">
                            <div class="p-2 bg-indigo-100 rounded-md"><svg class="h-4 w-4 text-indigo-500" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 7h8m0 0v8m0-8l-8 8-4-4-6 6"/></svg></div>
                            <span class="font-bold text-sm text-slate-600">Ventas Totales</span>
                        </div>
                        <div class="text-right">
                            <p id="monthlyReport-stats-ventas-value" class="font-bold text-slate-800 text-sm">$0.00</p>
                            <p id="monthlyReport-stats-ventas-change" class="text-xs font-mono text-slate-500">--%</p>
                        </div>
                    </div>
                    <!-- Ventas por Transferencia -->
                    <div class="flex items-center justify-between">
                        <div class="flex items-center space-x-2">
                            <div class="p-2 bg-purple-100 rounded-md"><svg class="h-4 w-4 text-purple-500" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m-15.356-2A8.001 8.001 0 0119.418 15m0 0H15"/></svg></div>
                            <span class="font-bold text-sm text-slate-600">Ventas por Transferencia</span>
                        </div>
                         <div class="text-right">
                            <p id="monthlyReport-stats-transferencia-value" class="font-bold text-slate-800 text-sm">$0.00</p>
                            <p id="monthlyReport-stats-transferencia-change" class="text-xs font-mono text-slate-500">--%</p>
                        </div>
                    </div>
                     <!-- Ganancias -->
                    <div class="flex items-center justify-between">
                        <div class="flex items-center space-x-2">
                            <div class="p-2 bg-amber-100 rounded-md"><svg class="h-4 w-4 text-amber-500" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 9V7a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2m2 4h10a2 2 0 002-2v-6a2 2 0 00-2-2H9a2 2 0 00-2 2v6a2 2 0 002 2zm7-5a2 2 0 11-4 0 2 2 0 014 0z"/></svg></div>
                            <span class="font-bold text-sm text-slate-600">Ganancias</span>
                        </div>
                        <div class="text-right">
                            <p id="monthlyReport-stats-ganancias-value" class="font-bold text-slate-800 text-sm">$0.00</p>
                            <p id="monthlyReport-stats-ganancias-change" class="text-xs font-mono text-slate-500">--%</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Right Panel (Chart & Transactions) -->
            <div class="col-span-12 lg:col-span-8 bg-white rounded-lg p-4 flex flex-col">
                 <!-- Header -->
                <div id="monthlyReport-selectedMonth" class="mb-4">
                    <span class="text-lg font-bold text-slate-800">Seleccione un mes</span>
                </div>
                <!-- Chart -->
                <div id="monthly-report-chart-container" class="flex-grow mb-4">
                    <canvas id="monthlyReportChart"></canvas>
                </div>

            </div>
        </div>

        <!-- Footer -->
        <div id="monthlyReport-footer-tip" class="p-3 bg-slate-200 border-t border-slate-300 rounded-b-lg text-center hidden">
             <p id="monthlyReport-footer-tip-text" class="text-xs text-slate-600">Tip: Compara la ganancia semanal para identificar tendencias.</p>
        </div>
    </div>
</div>


    

        <script src="nav.js"></script>
        <script src="resources/js/corte.js"></script>
</body>
</html>